@model IEnumerable<GestionBodega.Models.TicketResumenViewModel>

@{
    ViewData["Title"] = "Gestión de Tickets";
    var activos = Model.Where(x => x.Tipo == "SALIDA" && !x.NroTicket.StartsWith("DEV")).ToList();
}

<div class="container mt-4">
    <h2 class="fw-bold mb-4"><i class="fas fa-tasks text-primary"></i> Control de Proyectos</h2>

    <ul class="nav nav-tabs mb-3" id="ticketTabs" role="tablist">
        <li class="nav-item">
            <button class="nav-link active fw-bold" id="activos-tab" data-bs-toggle="tab" data-bs-target="#activos" type="button">
                <i class="fas fa-clock text-warning"></i> Proyectos En Curso
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link fw-bold" id="archivo-tab" data-bs-toggle="tab" data-bs-target="#archivo" type="button">
                <i class="fas fa-archive text-secondary"></i> Historial Archivado
            </button>
        </li>
    </ul>

    <div class="tab-content">

        <div class="tab-pane fade show active" id="activos">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-0">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr><th>Fecha</th><th>Cotización</th><th>Encargado</th><th>Obra</th><th>Acción</th></tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Where(x => x.Tipo == "SALIDA"))
                            {
                                <tr>
                                    <td>@item.Fecha.ToShortDateString()</td>
                                    <td class="fw-bold text-primary">@item.NroTicket</td>
                                    <td>@item.NombreTecnico</td>
                                    <td><span class="badge bg-info text-dark">@item.Proyecto</span></td>
                                    <td><a asp-action="Detalle" asp-route-id="@item.NroTicket" class="btn btn-sm btn-outline-dark">Ver</a></td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="archivo">
            <div class="alert alert-light border">
                <small class="text-muted"><i class="fas fa-info-circle"></i> Aquí aparecen los proyectos finalizados (con devolución realizada) y los ingresos de stock.</small>
            </div>
            <table class="table table-hover align-middle mb-0 text-muted">
                <thead class="table-light">
                    <tr><th>Fecha</th><th>Ticket</th><th>Tipo</th><th>Proyecto</th><th></th></tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.Where(x => x.Tipo == "ENTRADA"))
                    {
                        <tr>
                            <td>@item.Fecha.ToShortDateString()</td>
                            <td>@item.NroTicket</td>
                            <td>@(item.Tipo == "ENTRADA" ? "DEVOLUCIÓN/INGRESO" : "FINALIZADO")</td>
                            <td>@item.Proyecto</td>
                            <td><a asp-action="Detalle" asp-route-id="@item.NroTicket" class="btn btn-sm btn-light border">Ver</a></td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

    </div>
</div>